var EventFilter={options:null,globalEventId:0,objFontAwesome:null,$eventList:0,$filterBoard:null,$ctrlEventYear:null,$ctrlOrganizers:null,$ctrlSearch:null,$ctrlEventType:null,$ctrlDateStart:null,$ctrlDateStartHidden:null,queueRequest:function(){"use strict";var t=this;t.showLoadingIcon(),t.resetEventList(),t.globalEventId++;var e=t.globalEventId;window.setTimeout(function(){e===t.globalEventId&&t.fireXHR()},t.options.delay)},resetEventList:function(){"use strict";$(".alert-no-results-found").remove(),$(".event-item").each(function(){$(this).hide(),$(this).removeClass("visible")})},showLoadingIcon:function(){"use strict";var t=this;$(".loading-icon-lg").remove();var e=t.objFontAwesome.findIconDefinition({prefix:"fal",iconName:t.options.loadingIcon.iconName}),r=t.objFontAwesome.icon(e,{classes:t.options.loadingIcon.iconClasses}).html;t.$eventList.first().append(t.options.loadingIcon.html.replace("%s",r))},hideLoadingIcon:function(){"use strict";$(".loading-icon-lg").remove()},listEventsStartingFromDate:function(t){"use strict";var e=this,r=/^(.*)-(.*)-(.*)$/g.exec(t);if(r){var n=new Date(r[3],r[2]-1,r[1]),o=Math.round(n.getTime()/1e3);if(!isNaN(o))return e.$ctrlDateStartHidden.val(o),e.$ctrlDateStartHidden.attr("value",o),void e.queueRequest()}e.$ctrlDateStartHidden.attr("value","0"),e.$ctrlDateStartHidden.val("0"),e.queueRequest()},fireXHR:function(){"use strict";var t=this,e=0,r=[];$(".event-item").each(function(){r.push($(this).attr("data-id"))});var n=t.$ctrlEventType.val();t.sessionStorageSet("ctrl_eventType",n);var o=t.$ctrlOrganizers.val();t.sessionStorageSet("ctrl_organizers",JSON.stringify(o));var a=t.$ctrlDateStartHidden,i=Math.round(a.val())>0?a.val():0;i=Math.round(i);var s=t.$ctrlSearch.val();t.sessionStorageSet("ctrl_search",s);var l=t.options.xhr.action.split("?"),c=$.ajax({method:"post",url:l[0],data:{action:l[1],year:t.getUrlParam("year"),REQUEST_TOKEN:t.options.requestToken,ids:JSON.stringify(r),eventType:n,organizers:JSON.stringify(o),searchterm:s,startDate:i},dataType:"json"});c.done(function(r){r&&(t.hideLoadingIcon(),$.each(r.filter,function(t,r){$('.event-item[data-id="'+r+'"]').each(function(){$(this).show(),$(this).addClass("visible"),e++})}),0===e&&0===$(".alert-no-results-found").length&&t.$eventList.first().append(t.options.noResult.html),$("html, body").animate({scrollTop:t.$filterBoard.offset().top},500))}),c.fail(function(e){t.hideLoadingIcon(),window.console.log(e)})},getUrlParam:function(t){"use strict";var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return null===e?0:e[1]||0},sessionStorageGet:function(t){"use strict";try{if("undefined"!=typeof sessionStorage){var e=sessionStorage.getItem(t+"_"+this.options.filterBoardId);return""===e||null===e||"undefined"===e?null:e}}catch(t){window.console.log("Session Storage is disabled or not supported for this browser.")}return null},sessionStorageSet:function(t,e){"use strict";try{void 0!==window.sessionStorage&&sessionStorage.setItem(t+"_"+this.options.filterBoardId,e)}catch(t){window.console.log("Session Storage is disabled or not supported for this browser.")}return null},resetForm:function(){"use strict";var t=this;t.sessionStorageSet("ctrl_organizers",JSON.stringify([])),t.sessionStorageSet("ctrl_search",""),t.sessionStorageSet("ctrl_eventType",0),t.sessionStorageSet("ctrl_eventYear",0),t.sessionStorageSet("ctrl_dateStart","");var e=window.location.href.split("?");window.location.href=e[0]},initialize:function(t,e){"use strict";var r=this;if(r.$eventList=t,r.options=e,r.objFontAwesome=e.objFontAwesome,r.$filterBoard=$("#eventFilterBoard"),r.$ctrlOrganizers=$("#ctrl_organizers"),r.$ctrlSearch=$("#ctrl_search"),r.$ctrlEventType=$("#ctrl_eventType"),r.$ctrlEventYear=$("#ctrl_eventYear"),r.$ctrlDateStart=$("#ctrl_dateStart"),r.$ctrlDateStartHidden=$("#ctrl_dateStartHidden"),$(".reset-form").click(function(t){t.preventDefault(),r.resetForm()}),$(".close-event-filter-button").click(function(){r.$filterBoard.closest(".mod_article").addClass("d-none"),$(".toggle-filter-btn").removeClass("d-none"),$(".toggle-filter-btn").addClass("d-block"),$("html, body").animate({scrollTop:r.$filterBoard.offset().bottom},500)}),$(".toggle-filter-btn").click(function(){r.$filterBoard.closest(".mod_article").removeClass("d-none"),$(".toggle-filter-btn").addClass("d-none"),$(".toggle-filter-btn").removeClass("d-block"),$("html, body").animate({scrollTop:r.$filterBoard.offset().top},500)}),0===r.getUrlParam("organizer")){r.$ctrlOrganizers.select2({placeholder:"organisierende Gruppe"}),r.$ctrlOrganizers.on("select2:unselect",function(){window.setTimeout(function(){r.$ctrlOrganizers.select2("close")},100)}),r.$ctrlOrganizers.on("select2:opening select2:closing",function(t){$(this).parent().find(".select2-search__field").prop("disabled",!0)}),null!==r.sessionStorageGet("ctrl_search")&&r.$ctrlSearch.val(r.sessionStorageGet("ctrl_search"));var n=JSON.parse(r.sessionStorageGet("ctrl_organizers"));null!==n&&n.length&&(r.$ctrlOrganizers.val(n),r.$ctrlOrganizers.trigger("change")),null!==r.sessionStorageGet("ctrl_eventType")&&r.$ctrlEventType.val(r.sessionStorageGet("ctrl_eventType")),r.$ctrlEventYear.on("change",function(){var t=window.location.href.split("?");window.location.href=t[0]+"?year="+$(this).prop("value")}),r.$ctrlEventType.on("change",function(){r.queueRequest()}),r.$ctrlOrganizers.on("change",function(){r.sessionStorageSet("ctrl_organizers",JSON.stringify($(this).val())),r.queueRequest()}),r.$ctrlSearch.on("keyup",function(){r.queueRequest()});var o=r.sessionStorageGet("ctrl_dateStart");null===o&&(o=r.$ctrlDateStart.val()),r.$ctrlDateStart.val(o),r.listEventsStartingFromDate(o);var a={format:"dd-mm-yyyy",autoclose:!0,maxViewMode:0,language:"de"};r.getUrlParam("year")>0&&(a.startDate="01-01-"+r.getUrlParam("year"),a.endDate="31-12-"+r.getUrlParam("year")),$(".filter-board .input-group.date").datepicker(a).on("changeDate",function(){var t=r.$ctrlDateStart.val();r.listEventsStartingFromDate(t),r.sessionStorageSet("ctrl_dateStart",t)});var i=[];$(".event-item").each(function(){if(""!==$(this).attr("data-event-type")){var t=$(this).attr("data-event-type").split(",");jQuery.each(t,function(t,e){i.push(e)})}}),i=jQuery.unique(i),r.$ctrlEventType.find("option").each(function(){if($(this).attr("value")>0){var t=$(this).attr("value");jQuery.inArray(t,i)<0&&$(this).prop("disabled",!0)}}),r.resetEventList(),r.queueRequest()}else{var s=r.getUrlParam("organizer").split(",");r.sessionStorageSet("ctrl_organizers",JSON.stringify(s));var l=window.location.href.split("?");window.location.replace(l[0])}}};